# Финансовая модель системы фильтрации и генерации сопроводительных писем

## Тарифы BotHub (bothub.chat)

- **2,000,000 токенов** = **250 рублей**
- **Стоимость 1 токена** = 250 ₽ / 2,000,000 = **0.000125 ₽/токен**

## Расход токенов на операции

### 1. Фильтрация вакансий

**Параметры (batch_size=50):**
- System prompt: ~500 токенов
- Резюме кандидата: ~2,000 токенов
- Вакансии (50 вакансий в батче): ~4,000-5,000 токенов на батч
- Output (JSON ответ): ~100 токенов на вакансию (50 × 100 = 5,000 токенов)

**Расчёт на 1 батч (50 вакансий):**
```
Input токенов = 500 (system) + 2,000 (резюме) + 4,500 (вакансии, среднее) = 7,000 токенов
Output токенов = 50 вакансий × 100 токенов = 5,000 токенов
Итого на батч = 7,000 + 5,000 = 12,000 токенов
```

**На 1 вакансию при фильтрации:**
```
12,000 токенов / 50 вакансий = 240 токенов/вакансия
```

### 2. Генерация сопроводительного письма

**Параметры (по факту использования BotHub):**
- Общее количество токенов (CAPS) на письмо: **1,000 токенов**
- Это включает в себя: input (system prompt + резюме + вакансия) + output (текст письма)

**Расчёт на 1 письмо:**
```
Итого на письмо = 1,000 токенов (CAPS)
```

## Сценарий использования

### Исходные данные:
- **500 вакансий** фильтруется в сутки (для получения 200 релевантных)
- **200 релевантных вакансий** отбирается после фильтрации (40% релевантность)
- **200 сопроводительных писем** генерируется в сутки (максимум откликов на HH.ru)
- Использование: **каждый день в течение месяца (30 дней)**

### Расчёт на сутки:

#### Фильтрация 500 вакансий:
```
Количество батчей = 500 вакансий / 50 вакансий/батч = 10 батчей
Токенов в сутки (фильтрация) = 10 батчей × 12,000 токенов/батч = 120,000 токенов
Стоимость фильтрации = 120,000 × 0.000125 ₽/токен = 15.00 ₽
```

#### Генерация 200 писем:
```
Токенов в сутки (генерация) = 200 писем × 1,000 токенов/письмо = 200,000 токенов
Стоимость генерации = 200,000 × 0.000125 ₽/токен = 25.00 ₽
```

#### Итого в сутки:
```
Общий расход токенов = 120,000 + 200,000 = 320,000 токенов
Общая стоимость = 15.00 + 25.00 = 40.00 ₽
```

### Расчёт на месяц (30 дней):

```
Токенов в месяц = 320,000 токенов/день × 30 дней = 9,600,000 токенов
Стоимость в месяц = 40.00 ₽/день × 30 дней = 1,200.00 ₽
```

## Детальная таблица расходов

### По периодам

| Период | Фильтрация | | | Генерация писем | | | **Итого** |
|--------|------------|------------|------------|-----------------|------------|------------|------------|
| | Вакансий | Токены | Стоимость (₽) | Писем | Токены | Стоимость (₽) | Токены | **Стоимость (₽)** |
| **1 день** | 500 | 120,000 | 15.00 | 200 | 200,000 | 25.00 | 320,000 | **40.00** |
| **1 неделя** | 3,500 | 840,000 | 105.00 | 1,400 | 1,400,000 | 175.00 | 2,240,000 | **280.00** |
| **1 месяц (30 дней)** | 15,000 | 3,600,000 | 450.00 | 6,000 | 6,000,000 | 750.00 | 9,600,000 | **1,200.00** |

### Детализация по операциям

#### Фильтрация вакансий

| Период | Количество вакансий | Токены | Стоимость (₽) |
|--------|---------------------|--------|---------------|
| 1 день | 500 | 120,000 | 15.00 |
| 1 неделя | 3,500 | 840,000 | 105.00 |
| 1 месяц (30 дней) | 15,000 | 3,600,000 | 450.00 |

#### Генерация сопроводительных писем

| Период | Количество писем | Токены | Стоимость (₽) |
|--------|-------------------|--------|---------------|
| 1 день | 200 | 200,000 | 25.00 |
| 1 неделя | 1,400 | 1,400,000 | 175.00 |
| 1 месяц (30 дней) | 6,000 | 6,000,000 | 750.00 |

## Структура затрат

**Распределение расходов:**
- Фильтрация: **37.5%** от общей стоимости (15.00 ₽/день)
- Генерация писем: **62.5%** от общей стоимости (25.00 ₽/день)

**Распределение токенов:**
- Фильтрация: **37.5%** от общего количества токенов (120,000 токенов/день)
- Генерация писем: **62.5%** от общего количества токенов (200,000 токенов/день)

## Оптимизация расходов

### Варианты снижения затрат:

1. **Генерация писем только для топ-вакансий:**
   - Фильтровать 500 вакансий (15.00 ₽)
   - Генерировать письма только для топ-50 (50 × 1,000 = 50,000 токенов, 6.25 ₽)
   - **Итого в день: 21.25 ₽** (экономия 18.75 ₽/день)
   - **В месяц: 637.50 ₽** (экономия 562.50 ₽/месяц)

2. **Генерация писем для топ-100 вакансий:**
   - Фильтровать 500 вакансий (15.00 ₽)
   - Генерировать письма для топ-100 (100 × 1,000 = 100,000 токенов, 12.50 ₽)
   - **Итого в день: 27.50 ₽** (экономия 12.50 ₽/день)
   - **В месяц: 825.00 ₽** (экономия 375.00 ₽/месяц)

3. **Уменьшение количества фильтруемых вакансий:**
   - Если фильтровать 400 вакансий вместо 500:
   - Фильтрация: 8 батчей × 12,000 = 96,000 токенов (12.00 ₽)
   - При отборе 40% релевантных: 160 писем × 1,000 = 160,000 токенов (20.00 ₽)
   - **Итого в день: 32.00 ₽** (экономия 8.00 ₽/день)

4. **Увеличение batch_size для фильтрации:**
   - При batch_size=100 вместо 50:
   - При 500 вакансиях: 5 батчей вместо 10
   - Экономия на system prompt: ~2,500 токенов (0.31 ₽/день) - незначительно

## Выводы

**При активном использовании (500 фильтраций + 200 писем в день):**
- **Стоимость в сутки: 40.00 ₽**
- **Стоимость в месяц: 1,200.00 ₽**
- **Расход токенов в месяц: 9,600,000 токенов**

**Основные затраты:**
- Генерация писем — основной источник затрат (62.5% от общей стоимости)
- Фильтрация — значительная часть затрат (37.5% от общей стоимости)

**Рекомендации:**
- При текущих затратах (1000 токенов на письмо) система очень экономична
- Генерация для топ-50 снизит месячные расходы с 1,200 ₽ до 637.50 ₽ (экономия 562.50 ₽/месяц)
- Генерация для топ-100 снизит месячные расходы до 825 ₽ (экономия 375 ₽/месяц)
- При стоимости 1,200 ₽/месяц система окупается даже при генерации всех 200 писем

**Соотношение с лимитом HH.ru:**
- HH.ru позволяет откликаться на максимум 200 вакансий в сутки
- При генерации писем для всех 200 релевантных вакансий используется весь дневной лимит
- При генерации для топ-50 или топ-100 остаются резервы для ручных откликов
