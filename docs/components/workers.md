# Воркеры

Документация фоновых процессов (воркеров) в системе "Вкатился".

## Обзор

Воркеры — это фоновые процессы, которые выполняются асинхронно и обрабатывают задачи без блокировки основного приложения.

Все воркеры запускаются автоматически вместе с backend через FastAPI lifespan.

## Auto Reply Worker

**Назначение:** Автоматическая отправка откликов на релевантные вакансии.

**Как работает:**

1. Периодически проверяет резюме с включенными автооткликами
2. Находит новые совпадения резюме с вакансиями
3. Проверяет лимиты подписки пользователя
4. Генерирует сопроводительное письмо через AI
5. Отправляет отклик через HeadHunter API
6. Сохраняет информацию об отклике в БД
7. Отправляет уведомление через WebSocket

**Настройка:**

- Интервал проверки настраивается в коде воркера
- Порог совпадения настраивается для каждого резюме

**Логи:**

Логи сохраняются в `backend/logs/auto_reply_worker_{time}.log`

## Chat Analysis Worker

**Назначение:** Анализ чатов с работодателями и создание действий агента.

**Как работает:**

1. Периодически получает список чатов пользователя
2. Получает детали каждого чата
3. Анализирует сообщения через AI агента
4. Создает действия агента (например, "ответить на сообщение")
5. Отправляет уведомления пользователю

**Настройка:**

- Интервал проверки настраивается в коде воркера
- AI агент анализирует контекст чата и предлагает действия

**Логи:**

Логи сохраняются в `backend/logs/chat_analysis_worker_{time}.log`

## Telegram Bot Worker

**Назначение:** Обработка команд и сообщений Telegram бота.

**Как работает:**

1. Запускает Telegram бота
2. Обрабатывает команды от пользователей
3. Обрабатывает привязку/отвязку аккаунтов
4. Отправляет уведомления пользователям

**Команды бота:**

- `/start <token>` — привязка аккаунта
- `/unlink` — отвязка аккаунта
- `/help` — справка

**Настройка:**

Требуется `TELEGRAM_BOT_TOKEN` в переменных окружения.

**Логи:**

Логи сохраняются в `backend/logs/telegram_bot_worker_{time}.log`

## Управление воркерами

### Запуск

Воркеры запускаются автоматически при старте backend через FastAPI lifespan.

### Остановка

Воркеры останавливаются автоматически при остановке backend.

### Перезапуск

Для перезапуска воркеров перезапустите backend:

```bash
docker-compose restart backend
```

## Мониторинг воркеров

### Проверка работы

Проверьте логи воркеров:

```bash
tail -f backend/logs/auto_reply_worker_*.log
tail -f backend/logs/chat_analysis_worker_*.log
tail -f backend/logs/telegram_bot_worker_*.log
```

### Проблемы

Если воркер не работает:

1. Проверьте логи на ошибки
2. Убедитесь, что все зависимости настроены
3. Проверьте переменные окружения

## Связанные разделы

- [Архитектура](../architecture/data-flow.md) — потоки данных
- [Troubleshooting](../troubleshooting/common-issues.md) — решение проблем
